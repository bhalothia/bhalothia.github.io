---
layout: post
title: Using Python decorators for registering callbacks
date: '2013-07-13T20:23:00.001+05:30'
author: Saurabh
tags: 
- python
modified_time: '2013-07-13T20:40:44.270+05:30'
blogger_id: tag:blogger.com,1999:blog-590496507799049344.post-8800876569409631846
blogger_orig_url: http://curiosityhealsthecat.blogspot.com/2013/07/using-python-decorators-for-registering_8614.html
add_to_popular_list: true
---

<div dir="ltr" style="text-align: left;" trbidi="on">In my <a href="http://saurabh-hirani.github.io/writing/2013/07/13/using-python-decorators-for-registering_8614/" target="_blank">previous post</a> we talked about Python decorators and an intuitive way of remembering how decorators with arguments work. <br /><br />The following code snippet had triggered the whole chain of thought:<br /><br /><script src="https://gist.github.com/saurabh-hirani/5735116.js"></script><br />Now that we know what decorators with arguments do, which is essentially - calling the decorator factory with the argument, using the argument to make logical branching in the decorator wrapper and returning the wrapper, we can now try to understand the above code. We first move on to the decorator <b>route</b>'s source code found <a href="https://github.com/mitsuhiko/flask/blob/master/flask/app.py" target="_blank">here</a> to see it's implementation. Keep the source code opened in a different tab, as we will refer to it in the later sections.<br /><br /><script src="https://gist.github.com/saurabh-hirani/5743441.js"></script><br /><br />This code deviates a bit from what we think about how decorators are used - decorators wrap the functionality of a target function with certain pre and post actions, like so:<br /><br /><script src="https://gist.github.com/saurabh-hirani/5737741.js"></script><br /><br />Output:<br /><pre style="background-color: lightgrey; color: black;"><br /> Decorator calling func<br /> In the function<br /> Decorator called func<br /></pre><br />But there isn't any call to the target function <b>index</b> in the <b>route</b> function definition. Instead, this code snippet throws light on another functionality of decorators - registering callbacks.<br /><br />Callbacks are registered functions which are stored in some container data structure (mostly hashes with key as function name and value as function references). For example,<br /><br /><script src="https://gist.github.com/saurabh-hirani/5917820.js"></script><br />Output:<br /><pre style="background-color: lightgrey; color: black;"><br />  calling func1 with arg 1<br />  calling func2 with arg 2<br /></pre><br />They are useful in building a map of functions and depending on specific user input, the hashes are looked up and the corresponding key's value - which is a function reference is called.<br /><a name='more'></a><br />Let us revisit our main snippet. The decorator <b>@app.route('&amp;#47')</b> call leads to:<br /><br /><script src="https://gist.github.com/saurabh-hirani/5743441.js"></script><br />which in turn leads to the method <b>self.add_url_rule</b>:<br /><br /><script src="https://gist.github.com/saurabh-hirani/5990909.js"></script><br /><pre style="background-color: lightgrey; color: black;"><br />  app.add_url_rule('/', 'index', index)<br /></pre><br />says to Flask - when a user requests for <b>&amp;#47</b>, call the function mapped against the <b>index</b> key, which is the <b>index</b> function.<br /><br />So that's about it - write a function, declare a decorator above it, that decorator will take the function, store the reference of it in a hash, and will use it whenever an event occurs connected to the key against which the function reference was stored.<br /><br />Now to paint the whole picture here's a self-contained minimal example of using decorators for registering callbacks:<br /><br /><script src="https://gist.github.com/saurabh-hirani/5743458.js"></script><br /><br />Output:<br /><pre style="background-color: lightgrey; color: black;"><br />  This is the main page.<br />  This is the next page.<br /></pre><br />Hope you enjoyed going through this post. Do let me know your insights and views in the comments section.</div>
